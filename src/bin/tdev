#!/bin/bash


if [[ -z $1 ]]
then
    echo "Usage: $0 <project name>"
    exit 2
fi

projname=$1
venvsource="$HOME/.virtualenvs/$projname/bin/activate"
projdir=$HOME/devel/$projname


if [ ! -f $venvsource ]
then
    echo "Project does not have a virtual environement"
    echo "Creating one right now ..."
    sleep 2
    source /usr/share/virtualenvwrapper/virtualenvwrapper.sh
    mkvirtualenv -i ipython -i ipdb -i jedi $projname
    pip install ipython
    pip install ipdb 
    pip install jedi
fi


if [ ! -d $projdir ]
then
    echo "The project does not have a working directory"
    echo "creating one right now ..."
    sleep 2
    mkdir -p -v $projdir/src/
    echo "creating stup setup.py file"
    echo "can you ask for better..."
    mksetup $projname $projdir/

    echo "initializing git repository and setting version tag to 0.0"
    cd $projdir
    git init
    git add src/setup.py src/MANIFEST.in .gitignore
    git commit -m "initial commit of skeleton"
    git tag 0.0

fi

cd $projdir


if tmux a -t $projname
then
    echo "Found active session and attached"
else
    echo "Could not attach to session"
    tmux new-session -s $projname -d "source $HOME/.virtualenvs/$projname/bin/activate; vim "
    tmux split-window -t $projname -v -p 30 "source $HOME/.virtualenvs/$projname/bin/activate; $SHELL"
    tmux -2 attach-session -d -t $projname
fi
